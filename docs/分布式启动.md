# CV3 项目介绍

CV3 是一个基于 CosyVoice3-0.5B 的语音合成项目，支持分布式部署和高性能推理。

## 快速开始

### 1. 模型准备

1. 下载 FunAudioLLM/Fun-CosyVoice3-0.5B-2512，将模型文件放置到 `pretrained_models/Fun-CosyVoice3-0.5B` 目录
2. `pretrained_models/Fun-CosyVoice3-0.5B/CosyVoice-BlankEN` 下文件放到 `Fun-CosyVoice3-0.5B`
3. 将 `CV3\async_cosyvoice\cv3` 目录下的文件覆盖到 `pretrained_models/Fun-CosyVoice3-0.5B` 目录
4. 手动执行权限转换，参考：`权重转换.md`

### 2. 架构概述

#### 分布式架构（DISTRIBUTED_MODE=True）
```
┌─────────────────────┐          ┌─────────────────────────────┐
│     机器 A (LLM)    │          │     机器 B (Token2Wav)      │
│                     │  gRPC    │                             │
│  ┌───────────────┐  │ ──────>  │  ┌─────────┐  ┌─────────┐  │
│  │  LLM Service  │  │  tokens  │  │ GPU:0   │  │ GPU:1   │  │
│  │  (vLLM)       │  │          │  │ Service │  │ Service │  │
│  │  端口: 50000  │  │          │  │ :50001  │  │ :50002  │  │
│  └───────────────┘  │          │  └─────────┘  └─────────┘  │
└─────────────────────┘          └─────────────────────────────┘
```

### 3. 启动服务

```bash
# 终端 1: Token2Wav Service (GPU:1)
CUDA_VISIBLE_DEVICES=1 python token2wav_server.py --port 50001 --load_trt --fp16

# 终端 2: Token2Wav Service (GPU:2)
CUDA_VISIBLE_DEVICES=2 python token2wav_server.py --port 50002 --load_trt --fp16

# 终端 3: GRPC: LLM Service (GPU:0)
CUDA_VISIBLE_DEVICES=0 python server.py --port 50000 --fp16

# 终端 3: Socket: LLM Service (GPU:0)
CUDA_VISIBLE_DEVICES=0 python app.py
```
